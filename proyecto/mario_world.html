<!DOCTYPE html>
<html>

<head>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>

<body>
    <a-assets>
        <img src="images/ladrillo.png" id="ladrillo-color">
        <img src="images/ladrillo_normal.png" id="ladrillo-normal">
        <img src="images/bloque_interrogacion.png" id="bloque-q">
        <a-asset-item id="mario-gltf" src="models/mario_question_block/scene.gltf"></a-asset-item>
        <audio id="music-asset" src="sounds/mario_music.mp3" preload="auto"></audio>
        <audio id="coin-asset" src="sounds/coin.mp3" preload="auto"></audio>
    </a-assets>

    <!-- physics debug: true para ver colliders mientras pruebas -->
    <a-scene physics="gravity:-9.8; debug: true; maxSubSteps: 10"
        sound="src: #music-asset; volume: 0.5; loop: true; autoplay: true">

        <!-- Suelo (static bodies) -->
        <a-plane position="0 -0.1 0" rotation="-90 0 0" width="100" height="100" color="#83522f" static-body></a-plane>
        <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" color="#70a359" static-body></a-plane>

        <!-- Objetos con static-body -->
        <a-box position="5 1.05 -8" width="1.2" height="0.3" depth="1.2" color="#336622" static-body></a-box>
        <a-cylinder position="5 0.5 -8" radius="0.4" height="1" color="#489934" static-body></a-cylinder>

        <a-entity mixin="ladrillo-base" position="-3 0.5 -5" static-body="shape: box"></a-entity>
        <a-entity mixin="ladrillo-base" position="3 0.5 -5" static-body="shape: box"></a-entity>

        <a-gltf-model src="#mario-gltf" position="0 1.5 -5" scale="10 10 10" rotation="0 180 0"
            animation="property: position; to: 0 1.6 -5; dir: alternate; dur: 500; loop: true"
            sound="src: #coin-asset; on: click" static-body>
        </a-gltf-model>

        <a-sky color="#63a4ff"></a-sky>

        <!-- PLAYER RIG: dynamic-body + player-controller -->
        <!-- Usamos dynamic-body para que la física gestione las colisiones -->
        <a-entity id="player" 
            position="0 1.6 0" 
            geometry="primitive: cylinder; radius: 0.35; height: 1.6"
            material="visible: false" 
            dynamic-body="type: dynamic; mass: 1; shape: cylinder; linearDamping: 0.8; angularDamping: 1"
            player-controller>

            <!-- Cámara dentro del rig, look-controls con pointerLockEnabled -->
            <a-entity camera look-controls="pointerLockEnabled: true" position="0 0 0">
                <a-cursor></a-cursor>
            </a-entity>
        </a-entity>

        <!-- MIXINS para ladrillos/bloques -->
        <a-mixin id="ladrillo-base" geometry="primitive: box; width: 1; height: 1; depth: 1"
            material="src: #ladrillo-color; normalMap: #ladrillo-normal; normalScale: 1 -1">
        </a-mixin>

        <a-mixin id="bloque-interrogacion-base" geometry="primitive: box; width: 1; height: 1; depth: 1"
            material="src: #bloque-q">
        </a-mixin>

    </a-scene>
</body>

</html>