<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>Mario AABB estable</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

</head>

<body>

    <a-scene tabindex="0">

        <!-- SUELO -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#70a359">
        </a-plane>

        <!-- BLOQUES -->
        <a-box position="0 0.5 -4" color="#b44" class="obstacle"></a-box>
        <a-box position="2 0.5 -4" color="#b44" class="obstacle"></a-box>

        <!-- JUGADOR -->
        <a-entity id="player" position="0 1.6 4" wasd-controls="acceleration: 30" look-controls
            aabb-collider="objects: .obstacle" stop-on-collision>

            <a-entity camera></a-entity>
        </a-entity>

        <a-sky color="#63a4ff"></a-sky>
    </a-scene>

    <script>
        AFRAME.registerComponent('stop-on-collision', {
            init() {
                this.prevPosition = new THREE.Vector3();
                this.colliding = false;

                this.el.addEventListener('hitstart', () => {
                    this.colliding = true;
                });

                this.el.addEventListener('hitend', () => {
                    this.colliding = false;
                });
            },

            tick() {
                const pos = this.el.object3D.position;

                if (!this.colliding) {
                    this.prevPosition.copy(pos);
                } else {
                    pos.copy(this.prevPosition);
                }
            }
        });
    </script>

    <script>
        // foco del canvas
        window.addEventListener('load', () => {
            const scene = document.querySelector('a-scene');
            scene.addEventListener('loaded', () => {
                scene.canvas.focus();
            });
        });
    </script>

</body>

</html>